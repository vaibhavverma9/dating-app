{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nimport React, { useCallback } from 'react';\nimport { ConfirmScreen } from \"../Confirm-Screen\";\nimport { useConfirmPhone, useAuthFlowState } from 'react-doorman';\nimport * as firebase from 'firebase';\nexport default function ControlledConfirmScreen(props) {\n  var _useAuthFlowState = useAuthFlowState(),\n      phoneNumber = _useAuthFlowState.phoneNumber;\n\n  var _useConfirmPhone = useConfirmPhone({\n    onCodeVerified: function onCodeVerified(_ref) {\n      var token, _props$onCodeVerified;\n\n      return _regeneratorRuntime.async(function onCodeVerified$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              token = _ref.token;\n\n              if (!token) {\n                _context.next = 5;\n                break;\n              }\n\n              (_props$onCodeVerified = props.onCodeVerified) === null || _props$onCodeVerified === void 0 ? void 0 : _props$onCodeVerified.call(props, {\n                token: token\n              });\n              _context.next = 5;\n              return _regeneratorRuntime.awrap(firebase.auth().signInWithCustomToken(token).then(function (_ref2) {\n                var user = _ref2.user;\n\n                var _props$onUserSuccessf;\n\n                (_props$onUserSuccessf = props.onUserSuccessfullySignedIn) === null || _props$onUserSuccessf === void 0 ? void 0 : _props$onUserSuccessf.call(props, {\n                  user: user\n                });\n              }));\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    },\n    phoneNumber: phoneNumber\n  }),\n      code = _useConfirmPhone.code,\n      onChangeCode = _useConfirmPhone.onChangeCode,\n      loading = _useConfirmPhone.loading,\n      error = _useConfirmPhone.error,\n      resend = _useConfirmPhone.resend,\n      resending = _useConfirmPhone.resending;\n\n  var onPressResendCode = useCallback(function _callee() {\n    var _await$resend, success;\n\n    return _regeneratorRuntime.async(function _callee$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return _regeneratorRuntime.awrap(resend());\n\n          case 2:\n            _await$resend = _context2.sent;\n            success = _await$resend.success;\n\n            if (success) {\n              alert(\"\\u2705 6-digit code was resent to \".concat(phoneNumber, \".\"));\n            }\n\n          case 5:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }, [phoneNumber, resend]);\n  return React.createElement(ConfirmScreen, _extends({\n    code: code,\n    onChangeCode: onChangeCode,\n    loading: loading,\n    error: error,\n    resending: resending\n  }, {\n    phoneNumber: phoneNumber,\n    onPressResendCode: onPressResendCode\n  }, props));\n}","map":{"version":3,"sources":["Controlled-Confirm-Screen.tsx"],"names":["phoneNumber","useAuthFlowState","resending","useConfirmPhone","onCodeVerified","token","user","onPressResendCode","useCallback","success","resend","alert","code","onChangeCode","loading","error"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,OAAA,KAAA,IAAA,WAAA,QAAA,OAAA;AACA,SAAA,aAAA;AACA,SAAA,eAAA,EAAA,gBAAA,QAAA,eAAA;AAEA,OAAO,KAAP,QAAA,MAAA,UAAA;AAuCA,eAAe,SAAA,uBAAA,CAAA,KAAA,EAA+C;AAAA,0BACpCC,gBAAxB,EAD4D;AAAA,MACpDD,WADoD,qBACpDA,WADoD;;AAAA,yBASxDG,eAAe,CAAC;AAClBC,IAAAA,cAAc,EAAE;AAAA;;AAAA;AAAA;AAAA;AAAA;AAASC,cAAAA,KAAT,QAASA,KAAT;;AAAA,mBACd,KADc;AAAA;AAAA;AAAA;;AAGZ,eAAA,qBAAA,GAAA,KAAK,CAAL,cAAA,MAAA,IAAA,IAAA,qBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,qBAAA,CAAA,IAAA,CAAA,KAAA,EAAuB;AAAEA,gBAAAA,KAAAA,EAAAA;AAAF,eAAvB,CAAA;AAHY;AAAA,+CAIN,QAAQ,CAAR,IAAA,GAAA,qBAAA,CAAA,KAAA,EAAA,IAAA,CAGE,iBAAc;AAAA,oBAAXC,IAAW,SAAXA,IAAW;;AAAA,oBAAA,qBAAA;;AAClB,iBAAA,qBAAA,GAAA,KAAK,CAAL,0BAAA,MAAA,IAAA,IAAA,qBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,qBAAA,CAAA,IAAA,CAAA,KAAA,EAAmC;AAAEA,kBAAAA,IAAAA,EAAAA;AAAF,iBAAnC,CAAA;AAJJ,eAAM,CAJM;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KADE;AAalBN,IAAAA,WAAAA,EAAAA;AAbkB,GAAD,CATyC;AAAA,MAEtD,IAFsD,oBAEtD,IAFsD;AAAA,MAEtD,YAFsD,oBAEtD,YAFsD;AAAA,MAEtD,OAFsD,oBAEtD,OAFsD;AAAA,MAEtD,KAFsD,oBAEtD,KAFsD;AAAA,MAEtD,MAFsD,oBAEtD,MAFsD;AAAA,MAQ1DE,SAR0D,oBAQ1DA,SAR0D;;AAwB5D,MAAMK,iBAAiB,GAAGC,WAAW,CAAC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6CACVE,MAA1B,EADoC;;AAAA;AAAA;AAC5BD,YAAAA,OAD4B,iBAC5BA,OAD4B;;AAEpC,gBAAA,OAAA,EAAa;AACXE,cAAAA,KAAK,CAAA,qCAAA,MAAA,CAAA,WAAA,EAALA,GAAK,CAAA,CAALA;AACD;;AAJmC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAD,EAKlC,CAAA,WAAA,EALH,MAKG,CALkC,CAArC;AAOA,SACE,KAAA,CAAA,aAAA,CAAA,aAAA,EAAA,QAAA,CACM;AAAEC,IAAAA,IAAF,EAAEA,IAAF;AAAQC,IAAAA,YAAR,EAAQA,YAAR;AAAsBC,IAAAA,OAAtB,EAAsBA,OAAtB;AAA+BC,IAAAA,KAA/B,EAA+BA,KAA/B;AAAsCb,IAAAA,SAAAA,EAAAA;AAAtC,GADN,EAAA;AAEE,IAAA,WAAW,EAFb,WAAA;AAGE,IAAA,iBAAiB,EAAEK;AAHrB,GAAA,EADF,KACE,CAAA,CADF;AAQD","sourcesContent":["import React, { ComponentPropsWithoutRef, useCallback } from 'react'\nimport { ConfirmScreen } from '../Confirm-Screen'\nimport { useConfirmPhone, useAuthFlowState } from 'react-doorman'\n\nimport * as firebase from 'firebase'\n\ntype Props = Omit<\n  ComponentPropsWithoutRef<typeof ConfirmScreen>,\n  | 'onChangeCode'\n  | 'onPressResendCode'\n  | 'loading'\n  | 'code'\n  | 'phoneNumber'\n  | 'error'\n  | 'resend'\n  | 'resending'\n> & {\n  /**\n   * Optional callback function called whenever a user successfully confirms their phone number.\n   *\n   * You might want to use this to add to your analytics, for instance.\n   *\n   * `onCodeVerified` gets called _before_ `onUserSuccessfullySignedIn`. If you want to call a function after signing in, use `onUserSuccessfullySignedIn` instead.\n   *\n   * @example\n   * ```es6\n   * <AuthFlow.PhoneScreen onCodeVerified={({ token }) => analytics.track('Code Success')} />\n   * ```\n   */\n  onCodeVerified?: (info: { token: string }) => void\n  /**\n   * Optional callback function called whenever a user successfully signs in to the firebase app.\n   *\n   * This function gets called _after_ `onCodeVerified`. If you don't care about when the user signed in, but instead only a correct phone entry, use `onCodeVerified`.\n   *\n   * @example\n   * ```es6\n   * <AuthFlow.PhoneScreen onCodeVerified={({ token }) => analytics.track('Code Success')} />\n   * ```\n   */\n  onUserSuccessfullySignedIn?: (info: { user: firebase.User | null }) => void\n}\n\nexport default function ControlledConfirmScreen(props: Props) {\n  const { phoneNumber } = useAuthFlowState()\n  const {\n    code,\n    onChangeCode,\n    loading,\n    error,\n    resend,\n    resending,\n  } = useConfirmPhone({\n    onCodeVerified: async ({ token }) => {\n      if (token) {\n        // sign the user in\n        props.onCodeVerified?.({ token })\n        await firebase\n          .auth()\n          .signInWithCustomToken(token)\n          .then(({ user }) => {\n            props.onUserSuccessfullySignedIn?.({ user })\n          })\n      }\n    },\n    phoneNumber,\n  })\n  const onPressResendCode = useCallback(async () => {\n    const { success } = await resend()\n    if (success) {\n      alert(`âœ… 6-digit code was resent to ${phoneNumber}.`)\n    }\n  }, [phoneNumber, resend])\n\n  return (\n    <ConfirmScreen\n      {...{ code, onChangeCode, loading, error, resending }}\n      phoneNumber={phoneNumber}\n      onPressResendCode={onPressResendCode}\n      {...props}\n    />\n  )\n}\n"]},"metadata":{},"sourceType":"module"}