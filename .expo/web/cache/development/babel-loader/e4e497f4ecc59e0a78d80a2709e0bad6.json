{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nimport React, { useState } from 'react';\nimport { DoormanProvider, useDoormanContext } from 'react-doorman';\nimport { AuthGate } from \"../components/AuthGate\";\nimport { AuthFlow } from \"../views\";\nexport function withPhoneAuth(Component, options) {\n  var LoadingScreen = options.LoadingScreen,\n      _options$includeProvi = options.includeProvider,\n      includeProvider = _options$includeProvi === void 0 ? true : _options$includeProvi,\n      phoneScreenProps = options.phoneScreenProps,\n      confirmScreenProps = options.confirmScreenProps,\n      doorman = options.doorman,\n      SplashScreen = options.SplashScreen,\n      themeOption = options.theme,\n      initialPhoneNumber = options.initialPhoneNumber,\n      _onAuthStateChanged = options.onAuthStateChanged,\n      onCodeVerified = options.onCodeVerified,\n      onSmsSuccessfullySent = options.onSmsSuccessfullySent,\n      sharedScreenProps = _objectWithoutProperties(options, [\"LoadingScreen\", \"includeProvider\", \"phoneScreenProps\", \"confirmScreenProps\", \"doorman\", \"SplashScreen\", \"theme\", \"initialPhoneNumber\", \"onAuthStateChanged\", \"onCodeVerified\", \"onSmsSuccessfullySent\"]);\n\n  var WithFirebasePhoneAuth = function WithFirebasePhoneAuth(props) {\n    var _useState = useState(!SplashScreen),\n        _useState2 = _slicedToArray(_useState, 2),\n        splashDone = _useState2[0],\n        setSplashDone = _useState2[1];\n\n    var providerExistsAlready = useDoormanContext();\n    var Provider = !providerExistsAlready && includeProvider ? DoormanProvider : React.Fragment;\n    return React.createElement(Provider, _extends({\n      onAuthStateChanged: function onAuthStateChanged(user) {\n        _onAuthStateChanged === null || _onAuthStateChanged === void 0 ? void 0 : _onAuthStateChanged(user);\n        if (!user) setSplashDone(false);\n      },\n      initialPhoneNumber: initialPhoneNumber,\n      theme: themeOption\n    }, doorman), React.createElement(AuthGate, null, function (_ref) {\n      var loading = _ref.loading,\n          user = _ref.user;\n\n      if (loading) {\n        return LoadingScreen ? React.createElement(LoadingScreen, null) : React.createElement(React.Fragment, null);\n      }\n\n      if (user) return React.createElement(Component, _extends({}, props, {\n        user: user\n      }));\n      if (!splashDone && SplashScreen) return React.createElement(SplashScreen, {\n        next: function next() {\n          return setSplashDone(true);\n        }\n      });\n      return React.createElement(AuthFlow, _extends({}, sharedScreenProps, {\n        phoneScreenProps: phoneScreenProps,\n        confirmScreenProps: confirmScreenProps,\n        onSmsSuccessfullySent: onSmsSuccessfullySent,\n        onCodeVerified: onCodeVerified\n      }));\n    }));\n  };\n\n  return WithFirebasePhoneAuth;\n}","map":{"version":3,"sources":["with-phone-auth.tsx"],"names":["includeProvider","theme","onAuthStateChanged","onSmsSuccessfullySent","WithFirebasePhoneAuth","props","useState","providerExistsAlready","useDoormanContext","Provider","React","user","setSplashDone","themeOption","LoadingScreen","onCodeVerified"],"mappings":"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","sourcesContent":["import React, { ComponentType, ComponentPropsWithoutRef, useState } from 'react'\nimport {\n  DoormanProvider,\n  useDoormanContext,\n  ProviderProps,\n  InitializationProps,\n} from 'react-doorman'\nimport * as firebase from 'firebase/app'\n\nimport { AuthGate } from '../components/AuthGate'\nimport { AuthFlow } from '../views'\nimport ControlledPhoneAuth from '../views/Controlled/Controlled-Phone-Screen'\nimport ControlledConfirmScreen from '../views/Controlled/Controlled-Confirm-Screen'\nimport { CommonScreenProps } from '../views/types'\n\ntype Options = Omit<ProviderProps, 'children'> & {\n  LoadingScreen?: ComponentType\n  includeProvider?: boolean\n  /**\n   * Callback function called when a user's 6-digit code is verified, and they are authenticated.\n   *\n   * You might want to use this for analytics.\n   */\n  onCodeVerified?: ComponentPropsWithoutRef<\n    typeof ControlledConfirmScreen\n  >['onCodeVerified']\n  /**\n   * Callback function called when the an SMS is successfully sent to the user.\n   *\n   * Receives a dictionary with the auth `token` value.\n   */\n  onSmsSuccessfullySent?: ComponentPropsWithoutRef<\n    typeof ControlledPhoneAuth\n  >['onSmsSuccessfullySent']\n  phoneScreenProps?: ComponentPropsWithoutRef<\n    typeof AuthFlow\n  >['phoneScreenProps']\n  confirmScreenProps?: ComponentPropsWithoutRef<\n    typeof AuthFlow\n  >['confirmScreenProps']\n  /**\n   * **Required:** Your app's config for doorman.\n   *\n   * ```javascript\n   * {\n   *  projectId: string // projectId from firebase\n   * }\n   * ```\n   */\n  doorman: InitializationProps\n  /**\n   * (Optional) Your custom splash screen component that will appear before any auth screens are shown.\n   *\n   * It receives one prop: a function called `next` that should be called whenever a user wants to continue to the auth screens.\n   */\n  SplashScreen?: ComponentType<{ next: () => void }>\n} & CommonScreenProps\n\nexport function withPhoneAuth<P>(\n  Component: ComponentType<P & { user: firebase.User }>,\n  options: Options\n) {\n  // return () => null\n\n  const {\n    LoadingScreen,\n    includeProvider = true,\n    // tintColor,\n    phoneScreenProps,\n    confirmScreenProps,\n    doorman,\n    SplashScreen,\n    theme: themeOption,\n    initialPhoneNumber,\n    onAuthStateChanged,\n    onCodeVerified,\n    onSmsSuccessfullySent,\n    ...sharedScreenProps\n  } = options\n  const WithFirebasePhoneAuth = (props: P) => {\n    const [splashDone, setSplashDone] = useState(!SplashScreen)\n\n    /**\n     * If the context is non-null, this means a provider already exists in the component tree.\n     *\n     * If it doesn't, we add it ourselves. You can still deny `includeProvider` if you want.\n     */\n    const providerExistsAlready = useDoormanContext()\n    const Provider =\n      !providerExistsAlready && includeProvider\n        ? DoormanProvider\n        : React.Fragment\n    return (\n      <Provider\n        onAuthStateChanged={user => {\n          onAuthStateChanged?.(user)\n          if (!user) setSplashDone(false)\n        }}\n        initialPhoneNumber={initialPhoneNumber}\n        theme={themeOption}\n        {...doorman}\n      >\n        <AuthGate>\n          {({ loading, user }) => {\n            if (loading) {\n              return LoadingScreen ? <LoadingScreen /> : <></>\n            }\n\n            if (user) return <Component {...props} user={user} />\n\n            if (!splashDone && SplashScreen)\n              return <SplashScreen next={() => setSplashDone(true)} />\n\n            return (\n              <AuthFlow\n                {...sharedScreenProps}\n                phoneScreenProps={phoneScreenProps}\n                confirmScreenProps={confirmScreenProps}\n                onSmsSuccessfullySent={onSmsSuccessfullySent}\n                onCodeVerified={onCodeVerified}\n              />\n            )\n          }}\n        </AuthGate>\n      </Provider>\n    )\n  }\n  return WithFirebasePhoneAuth\n}\n"]},"metadata":{},"sourceType":"module"}