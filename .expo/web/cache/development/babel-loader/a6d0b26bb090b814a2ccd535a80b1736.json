{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/Users/vaibhavverma9/Desktop/realtalk-app/dating-app/App.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport * as Sentry from 'sentry-expo';\nimport 'react-native-gesture-handler';\nimport { ApolloClient, ApolloProvider, InMemoryCache } from '@apollo/client';\nimport { UserIdContextProvider } from \"./app/utils/context/UserIdContext\";\nimport { decode, encode } from 'base-64';\nimport { WebSocketLink } from 'apollo-link-ws';\nimport * as Segment from 'expo-analytics-segment';\nimport { DoormanProvider, AuthFlow, AuthGate } from 'react-native-doorman';\nimport ActivityIndicator from \"react-native-web/dist/exports/ActivityIndicator\";\nimport * as firebase from 'firebase';\nimport AppNavigator from \"./AppNavigator\";\nimport { colors } from \"./app/styles/colors\";\nimport { withOta } from \"./app/hoc/with-ota\";\nvar firebaseConfig = {\n  apiKey: \"AIzaSyCaXNTEyRQIS9NJfV56PvPXU7rvm82OVFk\",\n  authDomain: \"reeltalk-402aa.firebaseapp.com\",\n  databaseURL: \"https://reeltalk-402aa.firebaseio.com\",\n  projectId: \"reeltalk-402aa\",\n  storageBucket: \"reeltalk-402aa.appspot.com\",\n  messagingSenderId: \"602717352439\",\n  appId: \"1:602717352439:web:04ddfb94ae69256918fef2\",\n  measurementId: \"G-WCDWEF23HM\"\n};\nfirebase.initializeApp(firebaseConfig);\nvar iosWriteKey = \"0QHHf9Gg55EE10Hi5o0LYMfLMN4X7ypl\";\nvar androidWriteKey = \"idFwR27mq8yZxEpQFGdmdAJ0yzMM6wV0\";\n\nif (!global.btoa) {\n  global.btoa = encode;\n}\n\nif (!global.atob) {\n  global.atob = decode;\n}\n\nSentry.init({\n  dsn: 'https://8187be7306d04ef78c02712b775acea2@o380965.ingest.sentry.io/5207574',\n  enableInExpoDevelopment: true,\n  debug: true\n});\nvar graphqlEndpoint = 'https://reel-talk-2.herokuapp.com/v1/graphql';\n\nfunction App() {\n  return React.createElement(AuthenticatedApp, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 5\n    }\n  });\n}\n\nfunction AuthenticatedApp() {\n  return React.createElement(DoormanProvider, {\n    publicProjectId: \"zYoqBfXTFc7Ialp1SYGF\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 7\n    }\n  }, React.createElement(AuthGate, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 9\n    }\n  }, function (_ref) {\n    var user = _ref.user,\n        loading = _ref.loading;\n\n    if (loading) {\n      return React.createElement(ActivityIndicator, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 22\n        }\n      });\n    }\n\n    if (user) {\n      return React.createElement(DoormanAuthenticatedApp, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 74,\n          columnNumber: 22\n        }\n      });\n    }\n\n    return React.createElement(AuthFlow, {\n      backgroundColor: colors.primaryPurple,\n      headerTintColor: colors.secondaryWhite,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 20\n      }\n    });\n  }));\n}\n\nfunction DoormanAuthenticatedApp() {\n  var _useState = useState({\n    status: \"loading\"\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      authState = _useState2[0],\n      setAuthState = _useState2[1];\n\n  useEffect(function () {\n    Segment.initialize({\n      androidWriteKey: androidWriteKey,\n      iosWriteKey: iosWriteKey\n    });\n    Segment.screen('App Open');\n    authenticateFirebaseToken();\n  }, []);\n\n  function authenticateFirebaseToken() {\n    var user, token, idTokenResult, hasuraClaim, metadataRef;\n    return _regeneratorRuntime.async(function authenticateFirebaseToken$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            user = firebase.auth().currentUser;\n\n            if (!user) {\n              _context2.next = 12;\n              break;\n            }\n\n            _context2.next = 4;\n            return _regeneratorRuntime.awrap(user.getIdToken());\n\n          case 4:\n            token = _context2.sent;\n            _context2.next = 7;\n            return _regeneratorRuntime.awrap(user.getIdTokenResult());\n\n          case 7:\n            idTokenResult = _context2.sent;\n            hasuraClaim = idTokenResult.claims[\"https://hasura.io/jwt/claims\"];\n\n            if (hasuraClaim) {\n              setAuthState({\n                status: \"in\",\n                token: token\n              });\n            } else {\n              metadataRef = firebase.database().ref(\"metadata/\" + user.uid + \"/refreshTime\");\n              metadataRef.on(\"value\", function _callee(data) {\n                var token;\n                return _regeneratorRuntime.async(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        if (data.exists()) {\n                          _context.next = 2;\n                          break;\n                        }\n\n                        return _context.abrupt(\"return\");\n\n                      case 2:\n                        _context.next = 4;\n                        return _regeneratorRuntime.awrap(user.getIdToken(true));\n\n                      case 4:\n                        token = _context.sent;\n                        setAuthState({\n                          status: \"in\",\n                          token: token\n                        });\n\n                      case 6:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, null, null, null, Promise);\n              });\n            }\n\n            _context2.next = 13;\n            break;\n\n          case 12:\n            setAuthState({\n              status: \"out\"\n            });\n\n          case 13:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  return React.createElement(FirebaseAuthenticatedApp, {\n    authState: authState,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 5\n    }\n  });\n}\n\nfunction FirebaseAuthenticatedApp(_ref2) {\n  var authState = _ref2.authState;\n  var isIn = authState.status === \"in\";\n  var headers = isIn ? {\n    Authorization: \"Bearer \" + authState.token\n  } : {};\n  var client = new ApolloClient({\n    cache: new InMemoryCache(),\n    link: new WebSocketLink({\n      uri: graphqlEndpoint,\n      options: {\n        lazy: true,\n        reconnect: true,\n        connectionParams: {\n          headers: headers\n        }\n      }\n    })\n  });\n  return React.createElement(ApolloProvider, {\n    client: client,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 5\n    }\n  }, React.createElement(UserIdContextProvider, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 7\n    }\n  }, React.createElement(AppNavigator, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 9\n    }\n  })));\n}\n\nexport default withOta(App);","map":{"version":3,"sources":["/Users/vaibhavverma9/Desktop/realtalk-app/dating-app/App.tsx"],"names":["React","useState","useEffect","Sentry","ApolloClient","ApolloProvider","InMemoryCache","UserIdContextProvider","decode","encode","WebSocketLink","Segment","DoormanProvider","AuthFlow","AuthGate","firebase","AppNavigator","colors","withOta","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","initializeApp","iosWriteKey","androidWriteKey","global","btoa","atob","init","dsn","enableInExpoDevelopment","debug","graphqlEndpoint","App","AuthenticatedApp","user","loading","primaryPurple","secondaryWhite","DoormanAuthenticatedApp","status","authState","setAuthState","initialize","screen","authenticateFirebaseToken","auth","currentUser","getIdToken","token","getIdTokenResult","idTokenResult","hasuraClaim","claims","metadataRef","database","ref","uid","on","data","exists","FirebaseAuthenticatedApp","isIn","headers","Authorization","client","cache","link","uri","options","lazy","reconnect","connectionParams"],"mappings":"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","sourcesContent":["// import './wdyr'; \nimport React, { useState, useEffect } from 'react';\nimport * as Sentry from 'sentry-expo'; \nimport 'react-native-gesture-handler';\nimport { ApolloClient, ApolloProvider, InMemoryCache } from '@apollo/client';\nimport { UserIdContextProvider } from './app/utils/context/UserIdContext'; \nimport {decode, encode} from 'base-64'\nimport { WebSocketLink } from 'apollo-link-ws';\nimport * as Segment from 'expo-analytics-segment';\nimport { DoormanProvider, AuthFlow, AuthGate  } from 'react-native-doorman'; \nimport { ActivityIndicator } from 'react-native'\nimport * as firebase from 'firebase'; \nimport AppNavigator from './AppNavigator';\nimport { colors } from './app/styles/colors';\nimport { withOta } from './app/hoc/with-ota';\n\n// Set the configuration for your app\nconst firebaseConfig = {\n  apiKey: \"AIzaSyCaXNTEyRQIS9NJfV56PvPXU7rvm82OVFk\",\n  authDomain: \"reeltalk-402aa.firebaseapp.com\",\n  databaseURL: \"https://reeltalk-402aa.firebaseio.com\",\n  projectId: \"reeltalk-402aa\",\n  storageBucket: \"reeltalk-402aa.appspot.com\",\n  messagingSenderId: \"602717352439\",\n  appId: \"1:602717352439:web:04ddfb94ae69256918fef2\",\n  measurementId: \"G-WCDWEF23HM\"\n};\n\nfirebase.initializeApp(firebaseConfig);\n\nconst iosWriteKey = \"0QHHf9Gg55EE10Hi5o0LYMfLMN4X7ypl\"; \nconst androidWriteKey = \"idFwR27mq8yZxEpQFGdmdAJ0yzMM6wV0\"; \n\nif (!global.btoa) {\nglobal.btoa = encode;\n}\n\nif (!global.atob) {\nglobal.atob = decode;\n}\n\nSentry.init({\n  dsn: 'https://8187be7306d04ef78c02712b775acea2@o380965.ingest.sentry.io/5207574',\n  enableInExpoDevelopment: true,\n  debug: true\n}); \n\n\n\nconst graphqlEndpoint = 'https://reel-talk-2.herokuapp.com/v1/graphql'; \n// const graphqlEndpoint = 'https://vital-robin-42.hasura.app/v1/graphql'; \n\nfunction App() {\n  return(\n    <AuthenticatedApp  />\n  ) \n}\n\nfunction AuthenticatedApp (){\n  \n  return (\n      <DoormanProvider \n        publicProjectId=\"zYoqBfXTFc7Ialp1SYGF\"\n      >\n        <AuthGate>\n          {({ user, loading }) => {\n            \n            if (loading) {\n              return <ActivityIndicator/>\n            }\n\n            // if a user is authenticated\n            if (user) {\n              return <DoormanAuthenticatedApp />\n            }\n            \n\n            // otherwise, send them to the auth flow\n            return <AuthFlow \n              backgroundColor={colors.primaryPurple}\n              headerTintColor={colors.secondaryWhite}\n            />\n          }}\n        </AuthGate>\n      </DoormanProvider>\n  );\n}\n\nfunction DoormanAuthenticatedApp () {\n\n  const [authState, setAuthState] = useState({ status: \"loading\" });\n\n  useEffect(() => {\n    Segment.initialize({ androidWriteKey, iosWriteKey });\n    Segment.screen('App Open'); \n    authenticateFirebaseToken();\n  }, []);\n\n  async function authenticateFirebaseToken(){\n\n    const user = firebase.auth().currentUser; \n    if (user) {\n      const token = await user.getIdToken(); \n      const idTokenResult = await user.getIdTokenResult();\n      const hasuraClaim = idTokenResult.claims[\"https://hasura.io/jwt/claims\"];\n\n      \n      if(hasuraClaim){\n        setAuthState({ status: \"in\", token });\n      } else {\n        // Check if refresh is required.\n        const metadataRef = firebase\n          .database()\n          .ref(\"metadata/\" + user.uid + \"/refreshTime\");\n  \n        metadataRef.on(\"value\", async (data) => {\n          if(!data.exists()) return;\n          // Force refresh to pick up the latest custom claims changes.\n          const token = await user.getIdToken(true);\n          // console.log(token); \n          setAuthState({ status: \"in\", token });\n        });\n      }\n    } else {\n      setAuthState({ status: \"out\" });\n    }\n  }\n\n  return(\n    <FirebaseAuthenticatedApp authState={authState} />\n  )\n}\n\nfunction FirebaseAuthenticatedApp({authState}){\n\n  const isIn = authState.status === \"in\";\n  const headers = isIn ? { Authorization: `Bearer ${authState.token}` } : {};\n\n  const client = new ApolloClient({\n    cache: new InMemoryCache(),\n    link: new WebSocketLink({\n      uri: graphqlEndpoint,\n      options: {\n        lazy: true,\n        reconnect: true,\n        connectionParams: {\n          headers\n        }\n      }\n    })\n  });\n\n  // console.log(client); \n\n  return (\n    <ApolloProvider client={client}>\n      <UserIdContextProvider>\n        <AppNavigator />\n      </UserIdContextProvider>\n    </ApolloProvider>\n  )\n}\n\nexport default withOta(App);"]},"metadata":{},"sourceType":"module"}